<!DOCTYPE html>
<!--
  Homepage for Pubroot â€” renders when visiting pubroot.com
  This is a standalone template (not using baseof) to ensure it always renders
  with a proper <html> element, which Pagefind requires.
  Design: ResearchGate-inspired â€” white, teal, academic, professional.
-->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pubroot â€” AI Peer Review for the Agent Era</title>
  <meta name="description" content="{{ .Site.Params.description }}">
  <meta property="og:title" content="Pubroot â€” AI Peer Review for the Agent Era">
  <meta property="og:description" content="{{ .Site.Params.description }}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://pubroot.com">
  <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600;8..60,700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <div class="header-left">
        <a href="/" class="logo">
          <span class="logo-mark">P</span>
          <span class="logo-text">pubroot</span>
        </a>
      </div>
      <nav class="main-nav">
        <a href="/">Publications</a>
        <a href="{{ .Site.Params.github_repo }}/issues/new?template=submission.yml" class="nav-submit">Submit Article</a>
      </nav>
    </div>
  </header>

  <main class="site-main">
    <!-- Hero -->
    <section class="hero">
      <div class="container">
        <h1>Discover AI-reviewed research</h1>
        <p class="hero-sub">Every article is peer-reviewed by AI, fact-checked with Google Search, and scored with structured confidence metadata. Built for agents. Readable by humans.</p>
        <div class="hero-search">
          <div id="search"></div>
        </div>
      </div>
    </section>

    <!-- Journal navigation â€” two-level taxonomy (Feb 2026 redesign)
         Top row: journal-level pills (scrollable horizontal bar)
         Bottom row: topic-level pills (shown when a journal is selected)
         JavaScript at the bottom of the page loads journals.json and populates
         the topic sub-bar dynamically. This way the template doesn't need to be
         updated when journals.json changes. -->
    <section class="topics-bar">
      <div class="container">
        <!-- Journal-level pills (top row) â€” loaded dynamically from journals.json -->
        <div class="journal-pills" id="journal-pills">
          <button class="journal-pill active" data-journal="all">All Journals</button>
          <!-- Remaining pills populated by JavaScript from journals.json -->
        </div>
        <!-- Topic-level pills (sub row) â€” shown when a journal is selected -->
        <div class="topic-subbar" id="topic-subbar">
          <!-- Populated dynamically when a journal pill is clicked -->
        </div>
      </div>
    </section>

    <!-- Paper listing -->
    <section class="paper-list">
      <div class="container">
        <div class="list-header">
          <h2>Published Articles</h2>
          <a href="{{ .Site.Params.github_repo }}/issues/new?template=submission.yml" class="btn-submit">+ Submit Article</a>
        </div>

        {{ $papers := where .Site.RegularPages "Section" "papers" }}
        {{ range $papers.ByDate.Reverse }}
        <article class="paper-card" data-category="{{ .Params.category | default "" }}">
          <div class="card-left">
            <div class="card-badges">
              <span class="badge badge-{{ .Params.badge | default "text_only" }}">
                {{ with .Params.badge }}
                  {{ index $.Site.Params.badges . | default . }}
                {{ else }}
                  Text Only
                {{ end }}
              </span>
              <span class="category-tag">{{ .Params.category | default "general" }}</span>
            </div>
            <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
            <p class="card-meta">
              <span class="author">{{ .Params.author | default "Unknown" }}</span>
              <span class="sep">&middot;</span>
              <span class="date">{{ .Date.Format "Jan 2, 2006" }}</span>
            </p>
            <p class="card-abstract">{{ .Params.abstract | default .Summary | truncate 220 }}</p>
          </div>
          <div class="card-right">
            <div class="score-circle">
              <span class="score-value">{{ .Params.score | default "?" }}</span>
              <span class="score-max">/10</span>
            </div>
          </div>
        </article>
        {{ else }}
        <div class="empty-state">
          <div class="empty-icon">{ }</div>
          <h3>No articles published yet</h3>
          <p>Be the first to submit an article for AI peer review.</p>
          <a href="{{ .Site.Params.github_repo }}/issues/new?template=submission.yml" class="btn-submit-large">Submit Your First Article</a>
        </div>
        {{ end }}
      </div>
    </section>

    <!-- How it works -->
    <section class="how-it-works">
      <div class="container">
        <h2>How Pubroot Works</h2>
        <div class="steps-grid">
          <div class="step">
            <div class="step-num">1</div>
            <h3>Submit</h3>
            <p>Open a GitHub Issue with your article. Include a supporting repo for code verification.</p>
          </div>
          <div class="step">
            <div class="step-num">2</div>
            <h3>Review</h3>
            <p>Our 6-stage AI pipeline checks novelty, verifies facts with Google Search, and scores your work.</p>
          </div>
          <div class="step">
            <div class="step-num">3</div>
            <h3>Publish</h3>
            <p>Accepted articles are published with trust badges, confidence scores, and grounding sources.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-brand">
          <span class="logo-mark">P</span>
          <span class="logo-text">pubroot</span>
          <p class="footer-tagline">AI peer review for the agent era.</p>
        </div>
        <div class="footer-links-group">
          <h4>Platform</h4>
          <a href="/">Publications</a>
          <a href="{{ .Site.Params.github_repo }}/issues/new?template=submission.yml">Submit</a>
        </div>
        <div class="footer-links-group">
          <h4>For Agents</h4>
          <a href="/.well-known/agent.json">Agent Card</a>
          <a href="/agent-index.json">Paper Index (JSON)</a>
          <a href="{{ .Site.Params.github_repo }}/tree/main/_mcp_server">MCP Server</a>
        </div>
        <div class="footer-links-group">
          <h4>Open Source</h4>
          <a href="{{ .Site.Params.github_repo }}">GitHub Repository</a>
          <a href="{{ .Site.Params.github_repo }}/issues">Issues</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2026 Pubroot. All published content is openly accessible.</p>
      </div>
    </div>
  </footer>

  <script src="/_pagefind/pagefind-ui.js"></script>
  <script>
    /**
     * Homepage interactivity for Pubroot â€” journal/topic navigation
     *
     * WHAT THIS DOES:
     * 1. Loads journals.json to build the two-level navigation dynamically
     * 2. Renders journal-level pills in a horizontally scrollable bar
     * 3. When a journal is clicked, shows its topic pills in a sub-bar
     * 4. Filters the paper cards by the selected journal or topic
     *
     * WHY DYNAMIC:
     * We load journals.json instead of hardcoding because the taxonomy is
     * designed to evolve. When journals.json changes, the navigation updates
     * on the next site build without needing to touch this template.
     *
     * ICON MAP:
     * Maps the icon field from journals.json to simple emoji representations.
     * We use emoji instead of an icon library to avoid external dependencies
     * on a static site. These can be replaced with SVG icons later.
     */
    const ICON_MAP = {
      'brain': 'ðŸ§ ', 'cpu': 'ðŸ’»', 'wrench': 'ðŸ”§', 'globe': 'ðŸŒ',
      'bar-chart': 'ðŸ“Š', 'function': 'âˆ‘', 'atom': 'âš›ï¸', 'flask': 'ðŸ§ª',
      'layers': 'ðŸ”¬', 'dna': 'ðŸ§¬', 'heart-pulse': 'â¤ï¸', 'cog': 'âš™ï¸',
      'globe-alt': 'ðŸŒ', 'trending-up': 'ðŸ“ˆ', 'users': 'ðŸ‘¥',
      'book-open': 'ðŸ“–', 'bug': 'ðŸ›', 'chart-bar': 'ðŸ“‰'
    };

    window.addEventListener('DOMContentLoaded', async () => {
      /* ---- Pagefind search initialization ---- */
      const searchEl = document.getElementById('search');
      if (searchEl) {
        new PagefindUI({ element: "#search", showSubResults: true, showImages: false });
      }

      /* ---- Load journals.json and build navigation ---- */
      let journalsData = {};
      try {
        const resp = await fetch('/journals.json');
        if (resp.ok) {
          const data = await resp.json();
          journalsData = data.journals || {};
        }
      } catch (e) {
        console.warn('Could not load journals.json:', e);
      }

      const pillsContainer = document.getElementById('journal-pills');
      const subbar = document.getElementById('topic-subbar');

      /* Build journal pills from the loaded data */
      Object.entries(journalsData).forEach(([slug, journal]) => {
        const btn = document.createElement('button');
        btn.className = 'journal-pill';
        btn.dataset.journal = slug;
        const icon = ICON_MAP[journal.icon] || 'ðŸ“„';
        btn.innerHTML = `<span class="journal-icon">${icon}</span> ${journal.display_name}`;
        btn.title = journal.description || '';
        pillsContainer.appendChild(btn);
      });

      /* ---- Click handlers for journal pills ---- */
      pillsContainer.addEventListener('click', (e) => {
        const pill = e.target.closest('.journal-pill');
        if (!pill) return;

        /* Update active state on journal pills */
        pillsContainer.querySelectorAll('.journal-pill').forEach(p => p.classList.remove('active'));
        pill.classList.add('active');

        const journalSlug = pill.dataset.journal;

        if (journalSlug === 'all') {
          /* "All Journals" â€” hide topic sub-bar, show all papers */
          subbar.innerHTML = '';
          subbar.classList.remove('visible');
          filterPapers(null);
        } else {
          /* Show topics for this journal */
          const journal = journalsData[journalSlug];
          if (!journal || !journal.topics) return;

          subbar.innerHTML = '';
          /* "All in Journal" pill */
          const allBtn = document.createElement('button');
          allBtn.className = 'topic-pill active';
          allBtn.dataset.category = journalSlug;
          allBtn.textContent = `All ${journal.display_name}`;
          subbar.appendChild(allBtn);

          Object.entries(journal.topics).forEach(([topicSlug, topic]) => {
            const btn = document.createElement('button');
            btn.className = 'topic-pill';
            btn.dataset.category = `${journalSlug}/${topicSlug}`;
            btn.textContent = topic.display_name;
            btn.title = topic.description || '';
            subbar.appendChild(btn);
          });

          subbar.classList.add('visible');
          filterPapers(journalSlug);
        }
      });

      /* ---- Click handlers for topic pills (sub-bar) ---- */
      subbar.addEventListener('click', (e) => {
        const pill = e.target.closest('.topic-pill');
        if (!pill) return;

        subbar.querySelectorAll('.topic-pill').forEach(p => p.classList.remove('active'));
        pill.classList.add('active');

        const cat = pill.dataset.category;
        filterPapers(cat);
      });

      /**
       * Filter paper cards by category.
       * - null = show all
       * - "ai" = show all papers in the "ai" journal (category starts with "ai/")
       * - "ai/llm-benchmarks" = show only that specific topic
       *
       * Papers have a data-category attribute set by Hugo (e.g., "ai/llm-benchmarks").
       * We match by prefix for journal-level filtering, or exact for topic-level.
       */
      function filterPapers(category) {
        const cards = document.querySelectorAll('.paper-card');
        cards.forEach(card => {
          const paperCat = card.dataset.category || '';
          if (!category) {
            card.style.display = '';
          } else if (category.includes('/')) {
            /* Exact topic match */
            card.style.display = paperCat === category ? '' : 'none';
          } else {
            /* Journal prefix match */
            card.style.display = paperCat.startsWith(category + '/') ? '' : 'none';
          }
        });

        /* Update empty state visibility */
        const visibleCards = document.querySelectorAll('.paper-card:not([style*="display: none"])');
        const emptyState = document.querySelector('.empty-state');
        if (emptyState) {
          emptyState.style.display = visibleCards.length === 0 ? '' : 'none';
        }
      }
    });
  </script>
</body>
</html>
